<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buzón de Sugerencias | GP Mobility</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/styles_root.css">
    
    <style>
        :root{--primary:#001f3f;--secondary:#3b82f6;--bg-light:#f4f6f9;--text-dark:#333;--text-gray:#666;--white:#ffffff;}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
        body{background-color:var(--bg-light);min-height:100vh;display:flex;flex-direction:column;}
        .main-container{flex:1;width:100%;padding:40px 20px;display:flex;justify-content:center;align-items:center;margin-top:60px;}
        .suggestion-card{background:var(--white);max-width:1000px;width:100%;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.1);display:flex;overflow:hidden;flex-wrap:wrap;}
        .info-col{flex:1;padding:50px;background:linear-gradient(135deg,#001f3f 0%,#1e3a8a 100%);
        color:var(--white);min-width:320px;display:flex;flex-direction:column;justify-content:center;}
        .icon-header{width:70px;height:70px;background:rgba(255,255,255,0.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2rem;margin-bottom:25px;color:white;}
        .info-col h1{font-size:2.2rem;font-weight:700;margin-bottom:20px;line-height:1.2;}
        .info-col p{font-size:1.05rem;line-height:1.6;margin-bottom:30px;opacity:0.95;}
        .info-points{list-style:none;}
        .info-points li{margin-bottom:15px;display:flex;align-items:center;gap:15px;}
        .info-points i{background:rgba(255,255,255,0.2);padding:8px;border-radius:8px;font-size:0.9rem;}
        .form-col{flex:1.2;padding:50px;background:var(--white);min-width:320px;}
        .form-group{margin-bottom:25px;}
        .form-group label{display:block;font-weight:600;color:var(--primary);margin-bottom:8px;}
        .form-control,select,textarea{width:100%;padding:12px 15px;border:1px solid #e2e8f0;border-radius:8px;font-size:1rem;transition:all 0.3s;background-color:#f8fafc;color:var(--text-dark);}
        .form-control:focus,select:focus,textarea:focus{border-color:var(--secondary);outline:none;background-color:white;box-shadow:0 0 0 3px rgba(59,130,246,0.1);}
        textarea{resize:vertical;min-height:120px;}
        .anon-wrapper{display:flex;align-items:center;gap:10px;margin-bottom:30px;padding:15px;background-color:#f1f5f9;border-radius:8px;cursor:pointer;}
        .anon-wrapper input[type="checkbox"]{width:20px;height:20px;cursor:pointer;}
        .anon-wrapper span{font-size:0.95rem;color:var(--text-gray);user-select:none;}
        .btn-submit{width:100%;padding:15px;background-color:var(--primary);color:white;border:none;border-radius:10px;font-size:1.1rem;font-weight:bold;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:10px;}
        .btn-submit:hover{background-color:#003366;transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,31,63,0.2);}
        @media (max-width:800px){
            .suggestion-card{flex-direction:column;}
            .info-col,.form-col{padding:30px;}
            .main-container{margin-top:80px;}
        }
</style>
    
    <script type="module" src="js/auth_guard.js"></script>
</head>
<body>

    <section class="main-container">
        <div class="suggestion-card">
            
            <div class="info-col">
                <div class="icon-header">
                    <i class="far fa-lightbulb"></i>
                </div>
                <h1>Tu voz nos hace crecer</h1>
                <p>En GP Mobility creemos que las mejores ideas vienen de nuestro equipo. Este espacio es para escucharte.</p>
                
                <ul class="info-points">
                    <li>
                        <i class="fas fa-check"></i>
                        <span>Propón mejoras para tu área</span>
                    </li>
                    <li>
                        <i class="fas fa-heart"></i>
                        <span>Felicita a un compañero</span>
                    </li>
                    <li>
                        <i class="fas fa-user-secret"></i>
                        <span>Opción 100% anónima disponible</span>
                    </li>
                </ul>
            </div>

            <div class="form-col">
                <form id="buzon-form">
                    
                    <div class="form-group">
                        <label>Tipo de Mensaje</label>
                        <select id="tipo" required>
                            <option value="" disabled selected>Selecciona una opción...</option>
                            <option value="Mejora">Propuesta de Mejora</option>
                            <option value="Agradecimiento">Agradecimiento</option>
                            <option value="Queja">Queja o Inconformidad</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Departamento relacionado</label>
                        <select id="area" required>
                            <option value="General">General</option>
                            <option value="Accesorios">Accesorios</option>
                            <option value="Administración">Administración</option>
                            <option value="Comercial">Comercial</option>
                            <option value="Cultura y talento">Cultura y Talento</option>
                            <option value="Operaciones">Operaciones</option>
                            
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tu Mensaje</label>
                        <textarea id="mensaje" placeholder="Describe tu idea o situación con detalle..." required></textarea>
                    </div>

                    <label class="anon-wrapper">
                        <input type="checkbox" id="anonimo">
                        <span>Quiero enviar esto de forma <strong>Anónima</strong>.</span>
                    </label>

                    <button type="submit" class="btn-submit" id="btn-enviar">
                        <i class="fas fa-paper-plane"></i> Enviar al Buzón
                    </button>
                </form>
            </div>

        </div>
    </section>

    <script type="module">
        import { supabase } from './js/supabaseClient.js';

        const form = document.getElementById('buzon-form');
        const btnEnviar = document.getElementById('btn-enviar');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const tipo = document.getElementById('tipo').value;
            const area = document.getElementById('area').value;
            const mensaje = document.getElementById('mensaje').value;
            const esAnonimo = document.getElementById('anonimo').checked;

            const originalText = btnEnviar.innerHTML;
            btnEnviar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            btnEnviar.disabled = true;

            try {
                const { data: { user } } = await supabase.auth.getUser();

                if (!user) {
                    alert("Debes iniciar sesión para usar el buzón.");
                    window.location.href = 'login.html';
                    return;
                }

                const nuevaSugerencia = {
                    tipo: tipo,
                    area: area,
                    mensaje: mensaje,
                    es_anonimo: esAnonimo,
                    usuario_id: esAnonimo ? null : user.id 
                };

                const { error } = await supabase
                    .from('buzon')
                    .insert([nuevaSugerencia]);

                if (error) throw error;

                alert(esAnonimo ? "Mensaje enviado anónimamente. ¡Gracias!" : "Mensaje enviado con éxito. ¡Gracias por tu aporte!");
                form.reset();

            } catch (error) {
                console.error("Error:", error);
                alert("Hubo un error al enviar tu mensaje. Intenta de nuevo.");
            } finally {
                btnEnviar.innerHTML = originalText;
                btnEnviar.disabled = false;
            }
        });
    </script>

    <script type="module" src="js/component.js"></script>
</body>
</html>